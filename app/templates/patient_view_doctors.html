<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>View Doctors</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    .card { border-radius: 12px; box-shadow: 0px 3px 10px rgba(0,0,0,0.1); }
    .doctor-name { color: #2563eb; font-weight: 600; }
    .search-box { max-width: 400px; }
  </style>
</head>

<body class="bg-light">

<div class="container py-4">
  <h2 class="text-primary mb-4">Available Doctors</h2>
  <a href="{{ url_for('patient_dashboard') }}" class="btn btn-secondary mb-3">‚Üê Back to Dashboard</a>

  <!-- Search -->
  <input type="text" id="doctorSearch" class="form-control search-box mb-4" 
         placeholder="Search doctor or department..." onkeyup="filterDoctors()">

  <div class="row" id="doctorList">

    {% for d in doctors %}
    <div class="col-md-4 mb-4">
      <div class="card p-3">

        <!-- Doctor Name -->
        <h5 class="doctor-name mb-1">{{ d.name }}</h5>

        <!-- Department -->
        <p class="text-muted mb-1 doctor-dept">
          <strong>Department:</strong> {{ departments.get(d.department_id, 'N/A') }}
        </p>

        <!-- Email -->
        <p class="mb-1"><strong>Email:</strong> {{ d.email }}</p>

        <!-- Phone -->
        <p class="mb-1"><strong>Phone:</strong> {{ d.phone if d.phone else 'N/A' }}</p>

        <!-- Next Availability -->
        {% if next_availability.get(d.id) %}
          <p class="text-success mb-1">
            <strong>Next Available:</strong>
            {{ next_availability[d.id].date }}
            ({{ next_availability[d.id].start_time }} - {{ next_availability[d.id].end_time }})
          </p>
        {% else %}
          <p class="text-danger mb-1"><strong>No Slots Available</strong></p>
        {% endif %}

      </div>
    </div>
    {% endfor %}

  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<!-- UPDATED SEARCH SCRIPT -->
<script>
function filterDoctors() {
  let input = document.getElementById("doctorSearch").value.toLowerCase();

  document.querySelectorAll("#doctorList .card").forEach(card => {

    let name = card.querySelector(".doctor-name").textContent.toLowerCase();
    let dept = card.querySelector(".doctor-dept").textContent.toLowerCase();

    // Match by doctor name OR department
    card.parentElement.style.display =
      (name.includes(input) || dept.includes(input)) ? "" : "none";
  });
}
</script>

</body>
</html>
