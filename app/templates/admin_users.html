<!DOCTYPE html>
<html>
<head>
    <title>Manage Users</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <style>
        /* Scrollable table container */
        .table-scroll {
            max-height: 60vh;
            overflow-y: auto;
            display: block;
        }
        thead th {
            position: sticky;
            top: 0;
            background: #212529;
            color: white;
            z-index: 10;
        }
    </style>
</head>
<body class="bg-light">

<div class="container mt-4">

    <h2 class="mb-3">Manage Users</h2>
    <a href="{{ url_for('admin_dashboard') }}" class="btn btn-secondary mb-3">‚Üê Back to Dashboard</a>

    <!-- Search Box -->
    <input id="userSearchBox"
           class="form-control mb-3"
           type="text"
           placeholder="Search users by name, email or role...">

    <!-- Users Table -->
    <div class="card shadow-sm">
        <div class="card-header bg-dark text-white">
            Users List
        </div>

        <div class="card-body p-0">

            <!-- Scrollable container -->
            <div class="table-scroll">
                <table class="table table-bordered table-striped mb-0">
                    <thead class="table-dark">
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Phone</th>
                            <th>Role</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>

                    <tbody id="userTableBody">
                        {% for user in users %}
                        <tr>
                            <td>{{ user.id }}</td>
                            <td>{{ user.name }}</td>
                            <td>{{ user.email }}</td>
                            <td>{{ user.phone }}</td>
                            <td>{{ user.role }}</td>

                            <!-- Status Badge -->
                            <td>
                                {% if user.is_active %}
                                    <span class="badge bg-success">Active</span>
                                {% else %}
                                    <span class="badge bg-danger">Inactive</span>
                                {% endif %}
                            </td>

                            <td>
                                <!-- Edit -->
                                <a href="{{ url_for('edit_user', user_id=user.id) }}"
                                   class="btn btn-sm btn-primary">Edit</a>

                                <!-- Activate/Deactivate -->
                                <form method="POST"
                                      action="{{ url_for('toggle_user_status', user_id=user.id) }}"
                                      style="display:inline-block;">
                                    {% if user.is_active %}
                                        <button class="btn btn-sm btn-warning">Deactivate</button>
                                    {% else %}
                                        <button class="btn btn-sm btn-success">Activate</button>
                                    {% endif %}
                                </form>
                            </td>

                        </tr>
                        {% endfor %}
                    </tbody>

                </table>
            </div>

        </div>
    </div>

</div>

<!-- Search Filter Script -->
<script>
    const searchBox = document.getElementById("userSearchBox");
    const rows = document.querySelectorAll("#userTableBody tr");

    searchBox.addEventListener("input", () => {
        const query = searchBox.value.toLowerCase().trim();

        rows.forEach(row => {
            const name = row.children[1].innerText.toLowerCase();
            const email = row.children[2].innerText.toLowerCase();
            const role = row.children[4].innerText.toLowerCase();

            if (name.includes(query) || email.includes(query) || role.includes(query)) {
                row.style.display = "";
            } else {
                row.style.display = "none";
            }
        });
    });
</script>

</body>
</html>
