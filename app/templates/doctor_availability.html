<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Doctor Availability</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">

<div class="container mt-4">

  <h2 class="text-primary mb-3">Manage Availability</h2>
  <a href="{{ url_for('doctor_dashboard') }}" class="btn btn-secondary mb-3">‚Üê Back to Dashboard</a>

  <!-- Add Availability Form -->
  <div class="card shadow-sm mb-4">
    <div class="card-body">
      <h5 class="card-title mb-3">Add New Availability Slot</h5>

      <form method="POST" class="row g-3">

        <div class="col-md-4">
          <label class="form-label">Date</label>
          <input type="date" name="date" id="dateInput" class="form-control" required>
        </div>

        <div class="col-md-4">
          <label class="form-label">Start Time</label>
          <input type="time" name="start_time" class="form-control" required>
        </div>

        <div class="col-md-4">
          <label class="form-label">End Time</label>
          <input type="time" name="end_time" class="form-control" required>
        </div>

        <div class="col-12">
          <button type="submit" class="btn btn-primary">Add Slot</button>
        </div>

      </form>
    </div>
  </div>

  <!-- Existing Availability Slots -->
  <div class="card shadow-sm">
    <div class="card-body">
      <h5 class="card-title mb-3">Your Availability Slots</h5>

      {% if slots %}
      <table class="table table-striped table-bordered">
        <thead class="table-dark">
          <tr>
            <th>ID</th>
            <th>Date</th>
            <th>Start Time</th>
            <th>End Time</th>
            <th>Action</th>
          </tr>
        </thead>

        <tbody>
          {% for s in slots %}
          <tr>
            <td>{{ s.id }}</td>
            <td>{{ s.date }}</td>
            <td>{{ s.start_time.strftime('%H:%M') }}</td>
            <td>{{ s.end_time.strftime('%H:%M') }}</td>
            <td>
              <form method="POST"
                    action="{{ url_for('delete_availability', slot_id=s.id) }}"
                    style="display:inline;">
                <button type="submit" class="btn btn-sm btn-danger"
                        onclick="return confirm('Delete this slot?')">
                  üóë Delete
                </button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>

      </table>

      {% else %}
        <p class="text-muted">No availability slots added yet.</p>
      {% endif %}

    </div>
  </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<!-- ===== Restrict Date Picker to Today + Next 6 Days ===== -->
<script>
  const dateInput = document.getElementById("dateInput");

  const today = new Date();
  const maxDate = new Date();
  maxDate.setDate(today.getDate() + 6);

  const pad = n => n.toString().padStart(2, '0');

  const todayStr =
    `${today.getFullYear()}-${pad(today.getMonth() + 1)}-${pad(today.getDate())}`;

  const maxDateStr =
    `${maxDate.getFullYear()}-${pad(maxDate.getMonth() + 1)}-${pad(maxDate.getDate())}`;

  dateInput.min = todayStr;
  dateInput.max = maxDateStr;
</script>

</body>
</html>
